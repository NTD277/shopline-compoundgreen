{{#var product = props.product /}}

{{#if product && product.available && block.settings.product_quick_add }}
  {{#var variants_size = product | get_variants() | size() /}}
  {{#if variants_size == 1}}
    {{#component "script" src="product/form.js" | asset_url() /}}
    <theme-product-form
      data-default-error-message="{{ `products.general.no_product_data_found` | t() }}"
      data-add-to-cart-text="{{ `products.product_list.add_to_cart` | t() }}"
      data-sold-out-text="{{ `products.general.sold_out` | t() }}"
      data-unavailable-text="{{ `products.general.unavailable` | t() }}"
      {{{block.shopline_attributes}}}
    >
      {{#capture product_form_id}}quick-add-product-form-{{product.id}}{{/capture}}
      {{#product_form product id=product_form_id}}
        <input type="hidden" name="id" value="{{product.first_available_variant.id}}" />
        <input type="hidden" required name="quantity" value="1" />
         <button
          class="block-product-card__quick-add"
          type="submit"
          name="add"
          style="
            color: {{block.settings.quick_add_text_color}};
            background-color: {{block.settings.quick_add_bg_color}};
            {{#if block.settings.quick_add_shape == 'rounded'}}border-radius: 8px;{{/if}}
            {{#if block.settings.quick_add_shape == 'pill'}}border-radius: 999px;{{/if}}
            {{#if block.settings.quick_add_shape == 'square'}}border-radius: 0;{{/if}}
          "
          {{#if !product.first_available_variant.available}}
            disabled
          {{/if}}
        >
          {{block.settings.quick_add_text}}
        </button>
      {{/product_form}}
    </theme-product-form>
  {{#else/}}
    {{#component "stylesheet" src="components/modal/index.css" | asset_url() /}}
    {{#component "script" src="components/modal/index.js" | asset_url() /}}
    {{#component "script" src="./quick-add-modal.js" | asset_url() /}}

    <theme-quick-add-modal
      data-theme-modal
      data-mask-closable
      data-esc-to-exit
      data-popup-container="body"
      product-url="{{product.url}}"
      {{{block.shopline_attributes}}}
    >
      <details>
      <summary class="block-product-card__quick-add"
        style="
          color: {{block.settings.quick_add_text_color}};
          background-color: {{block.settings.quick_add_bg_color}};
          {{#if block.settings.quick_add_shape == 'rounded'}}border-radius: 8px;{{/if}}
          {{#if block.settings.quick_add_shape == 'pill'}}border-radius: 999px;{{/if}}
          {{#if block.settings.quick_add_shape == 'square'}}border-radius: 0;{{/if}}
        "
      >
        {{block.settings.quick_add_text}}
      </summary>

        <div class="block-product-card__modal">
          <div class="block-product-card__modal-content"></div>
          <button name="close" class="modal__close-control block-product-card__modal-close">
            {{#component "icons/close" class="icon-close" /}}
          </button>
        </div>
      </details>
    </theme-quick-add-modal>

  {{/if}}
{{/if}}

{{#schema}}
{
  "name": "t:blocks.product_list.quick.add.name",
  "tag": "",

  "settings": [
    {
      "type": "checkbox",
      "id": "product_quick_add",
      "label": "Hiển thị nút Quick Add",
      "default": true
    },
    {
      "type": "text",
      "id": "quick_add_text",
      "label": "Nội dung nút Quick Add",
      "default": "QUICK ADD"
    },
    {
      "type": "color",
      "id": "quick_add_text_color",
      "label": "Màu chữ nút Quick Add",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "quick_add_bg_color",
      "label": "Màu nền nút Quick Add",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "quick_add_shape",
      "label": "Hình dạng nút Quick Add",
      "options": [
        { "value": "rounded", "label": "Bo tròn" },
        { "value": "pill", "label": "Pill (tròn dài)" },
        { "value": "square", "label": "Vuông góc" }
      ],
      "default": "rounded"
    }
  ],

  "presets": [
    {
      "name": "t:blocks.product_list.quick.add.presets.presets_0.name"
    }
  ]
}
{{/schema}}
